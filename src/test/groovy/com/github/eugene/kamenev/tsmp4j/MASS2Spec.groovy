package com.github.eugene.kamenev.tsmp4j

class MASS2Spec extends BaseSpec {

  def 'test moving stats method'() {
    given:
    var meanx = new double[]{56.97833333333333, 63.88666666666666, 65.14166666666667, 66.98666666666668, 68.92833333333334,
      67.07000000000001, 62.610000000000014, 55.49666666666669, 51.97166666666669, 50.76833333333335, 48.416666666666686,
      47.23333333333335, 46.95000000000001, 48.238333333333344, 47.623333333333335, 43.80666666666665, 38.54999999999999,
      35.31166666666667, 33.916666666666686, 31.30666666666669, 30.18833333333335, 32.00833333333336, 35.246666666666705,
      37.67833333333336, 38.964999999999996, 43.554999999999986, 47.28666666666667, 46.54, 47.47666666666665,
      51.72333333333332, 52.291666666666664, 49.10499999999998, 47.04499999999996, 44.2483333333333, 39.19999999999997,
      29.306666666666654, 21.85833333333331, 19.79833333333333, 16.660000000000007, 15.941666666666682, 16.958333333333332,
      20.49666666666667, 23.42500000000003, 23.00333333333337, 24.860000000000014, 26.518333333333317, 27.37833333333333,
      29.634999999999952, 38.554999999999914, 48.34999999999991, 55.056666666666615, 62.63166666666666, 72.5,
      80.98333333333335, 81.76500000000003, 82.06666666666668, 83.31333333333335, 81.6583333333333, 76.90166666666664,
      72.91000000000001, 70.1833333333334, 65.42500000000003, 60.30000000000003, 56.98166666666672, 54.22666666666669,
      49.63333333333336, 47.32166666666664, 47.166666666666664, 50.086666666666666, 51.685000000000024, 52.97833333333339,
      54.7166666666667, 52.081666666666706, 48.49333333333334, 44.98333333333335, 44.39499999999998, 43.714999999999996,
      41.48000000000002, 43.53333333333338, 47.62500000000008, 48.433333333333394, 47.84833333333336, 46.823333333333345,
      47.24833333333337, 44.24666666666675, 39.691666666666755, 33.60666666666672, 31.19333333333346, 28.82500000000012,
      26.490000000000084, 25.428333333333438, 27.071666666666715, 28.783333333333456, 27.95500000000008, 29.285000000000007,
      33.61333333333338, 37.22166666666666, 36.64000000000002, 38.559999999999945, 40.916666666666664, 41.77666666666679,
      39.26333333333347, 38.36166666666683, 40.30166666666688, 39.968333333333554, 35.981666666666875, 33.206666666666784,
      30.625, 27.283333333333303, 27.221666666666653, 29.171666666666624, 36.87833333333325, 45.43166666666669,
      52.5916666666667, 59.88833333333332, 62.566666666666606, 66.02333333333338, 63.04333333333337, 57.964999999999996,
      55.30000000000003, 54.41166666666671, 53.52333333333339, 49.24166666666664}
    var stdx = new double[]{11.205488858392386, 8.859045596952877, 8.092155495018396, 7.219989996915125, 5.836184303311671,
      8.961688828935426, 10.66173844486278, 12.299532059752776, 12.641325638115884, 11.336509481415344, 8.355063667554361,
      8.55035606795927, 8.55769828867549, 7.135994246696644, 7.7812716755610385, 5.753812262800753, 7.306132127649141,
      8.818708175741374, 7.591013693103589, 6.731492322574998, 6.001170487681533, 8.972230151355117,
      8.814746482772577, 7.063543531558276, 7.622223538224657, 7.408460816301085, 5.908862458676517,
      5.955851464456508, 5.749668589483397, 6.5635982678882305, 6.121618567739408, 8.54557146519007,
      8.621171130807717, 11.348348509315896, 14.593930245139672, 14.871492490294674, 14.4382090494478,
      13.16164936050527, 9.260584934729184, 8.528554814399856, 9.087220727788912, 7.389658690058439,
      1.180829510697277, 1.5726163620610993, 4.332258841143639, 5.200607069265233, 5.1959196063409205,
      6.59441367118181, 17.292897144974667, 20.69751836976295, 21.431923748361, 20.359174358395606,
      15.732365789458694, 6.145816101670342, 5.635026619279958, 5.550296288387244, 4.334503688107367,
      6.931888671607309, 9.70028937139968, 8.399490063886475, 8.352831190014268, 8.812530378197783,
      6.564492872009326, 6.521808074111704, 7.931985179567866, 7.832921265757369, 4.89052286457099,
      4.729699309211294, 9.304360387593665, 9.753744152887982, 9.09336831004964, 6.843699454404455,
      10.407035147223828, 13.225875732400041, 9.844789936249736, 9.105530828384715, 8.700338594943467,
      8.841129264220859, 8.235924693411722, 6.538758164462372, 6.747539469234814, 6.305260810536234,
      6.789147385513276, 6.102033586345296, 9.427538856397248, 9.826944958745596, 11.394896030923459,
      8.57135863728065, 7.365939066631777, 6.259763041308707, 6.427815638993714, 7.84199893026176,
      6.08933676373851, 5.211860672223172, 5.775923447092289, 8.957921385877107, 7.737914052823786,
      7.839170874524836, 6.225608404004145, 5.915690060245578, 5.330433586699145, 4.406335085859736,
      3.998117960017442, 4.149708490429382, 4.435847971043442, 7.139473408841004, 8.162012959776089,
      9.584960006872207, 9.91709242783517, 9.80432118450266, 12.133742781552877, 18.304075517642413,
      21.705361408852042, 18.787199025459206, 10.6664949204925, 8.391977650643852, 4.856691832467218,
      7.364897977720074, 8.00532479041327, 8.764165676206682, 8.325535851956724, 7.8264246129514605,
      5.467148606805691}

    when:
    var stats = MASS2.movingAverageAndStd(timeSeries, 6)

    then:
    equals(meanx, stats[0])
    equals(stdx, stats[1])
  }

  def 'test mass2 distance for query'() {
    given:
    var distOrig = new double[]{2.3668965327355567, 3.4060132019942193, 2.9032584986134187, 0.697189360491946,
      2.564482199238838, 4.173952551042108, 3.641533468524242, 3.5935776279373743, 4.137081417670844,
      4.457607139901744, 4.431555859764974, 3.213841006777569, 0.6047023031090474, 3.1041799031762967,
      4.470441329915717, 4.125780530323814, 3.738677184993776, 3.759127813545457, 4.043050494354343,
      4.786387167956826, 3.8406642856176942, 2.661562742597054, 3.525910756817523, 3.214588771573668,
      1.1673105773258903, 2.9681630725325654, 4.231684110779005, 2.8078035727048456, 6.542950391799256E-7,
      3.1069506036555286, 4.513042682841856, 3.218706435381751, 2.14488563384738, 3.934956034027165,
      4.225083663458599, 3.821761785345017, 3.8462063907011657, 4.406442054759158, 4.790377123441251,
      3.743087824261052, 1.909940763238877, 1.9294311137988711, 3.4722046944838154, 2.3718192858198504,
      3.1911690614398625, 4.05382033055673, 3.3815347090246832, 1.9174055058897412, 3.1006973624748007,
      3.6546095561285057, 2.9117004242206312, 1.6556301961839521, 1.9580427423249531, 3.6387515556921874,
      3.1606124690560313, 0.5679781945823819, 2.6433757557568747, 4.202408197533685, 3.7523411112426395,
      3.551779992997057, 4.496782247434107, 4.468366408151725, 3.4920148506394533, 3.6050715839335767,
      4.3411447021426675, 4.200149269689229, 3.8578490765041473, 4.594175173745556, 3.712677713373182,
      3.2302948287732107, 1.9189154504499335, 1.683469236170608, 3.460319505045696, 4.021019724347921,
      4.0968741684324295, 4.605768013107236, 4.156449059287281, 2.04022853964161, 1.162981698471108,
      4.042829593212975, 4.631619198358055, 3.0044301207350115, 1.6435869891044623, 2.8731404638900333,
      3.8757666746586934, 4.028357105034631, 4.2079409247915605, 4.002642512635227, 4.6636060949775064,
      3.7191735149087055, 2.6233748670246717, 2.8037366924403546, 4.738290579046625, 3.0049182185798626,
      2.435347999888012, 3.1701103260300556, 3.857215751196695, 2.216149228999814, 0.9865620496359858,
      3.234225731274193, 4.87346503179918, 3.5164137887045586, 1.1752178091695555, 3.5783341298193423,
      4.707989622267232, 3.2710825465503457, 2.758679505488824, 4.001399279436573, 4.5007815474411155,
      3.929933232627954, 3.842705957813346, 3.233840801437425, 2.7655709988782506, 2.369719266273785,
      1.2783561136897605, 1.6938320830185023, 4.191468434347509, 4.417641498556896, 3.1458027081346565,
      3.396909990444282, 4.313077021928001, 4.804077187095176, 3.5059890582542703}

    when:
    var dist = MASS2.mpDist(timeSeries, query)

    then:
    equals(dist, distOrig)
  }

}
